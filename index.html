<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ë–ª–µ–∫–∞—É—Ç-–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --bg-app: #e0e5ec;
            --text-main: #4a4a4a;
            --radius: 20px;
            --neumorph-shadow-light: #ffffff;
            --neumorph-shadow-dark: #a3b1c6;

            /* === –ö–û–õ–¨–û–†–ò –ì–†–ê–§–Ü–ö–£ (Default) === */
            --chart-bg: #ffffff;
            --light-bg: #fbbf24;   
            --light-text: #1f2937; 
            --dark-bg: #1f2937;    
            --dark-text: #ffffff;  
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-app);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        .app-container {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        /* NEUMORPHISM CARD STYLE */
        .card {
            background: var(--bg-app);
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: 9px 9px 16px var(--neumorph-shadow-dark), 
                       -9px -9px 16px var(--neumorph-shadow-light);
            border: 1px solid rgba(255,255,255,0.2);
        }

        h2 { margin: 0 0 20px 0; font-weight: 800; color: #333; }

        /* INPUTS */
        .input-neumorph {
            width: 100%;
            border: none;
            border-radius: 12px;
            padding: 15px;
            font-family: inherit;
            background: var(--bg-app);
            box-shadow: inset 6px 6px 10px var(--neumorph-shadow-dark), 
                        inset -6px -6px 10px var(--neumorph-shadow-light);
            box-sizing: border-box;
            color: #333;
            outline: none;
            transition: 0.3s;
        }
        
        .input-neumorph:focus {
            box-shadow: inset 4px 4px 8px var(--neumorph-shadow-dark), 
                        inset -4px -4px 8px var(--neumorph-shadow-light);
        }

        textarea.input-neumorph { height: 100px; resize: none; font-family: monospace; }
        
        select.input-neumorph {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23333%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 15px top 50%;
            background-size: 12px auto;
        }

        /* BUTTONS */
        .btn-group { display: flex; gap: 15px; margin-top: 20px; }
        
        .btn-neu {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 15px;
            cursor: pointer;
            background: var(--bg-app);
            box-shadow: 6px 6px 10px var(--neumorph-shadow-dark), 
                       -6px -6px 10px var(--neumorph-shadow-light);
            color: #333;
            transition: all 0.2s ease;
            display: flex; justify-content: center; align-items: center; gap: 8px;
        }

        .btn-neu:active {
            box-shadow: inset 4px 4px 8px var(--neumorph-shadow-dark), 
                        inset -4px -4px 8px var(--neumorph-shadow-light);
            transform: scale(0.98);
        }

        .btn-primary { color: #007aff; }
        .btn-danger { color: #ff3b30; }
        .btn-action { margin-top: 15px; width: 100%; background: #007aff; color: white; box-shadow: 6px 6px 15px rgba(0,122,255,0.3); }
        .btn-action:active { background: #0063cf; box-shadow: inset 2px 2px 5px rgba(0,0,0,0.2); }

        /*         /* === –ó–û–ù–ê –ì–ï–ù–ï–†–ê–¶–Ü–á (–ü–†–ò–•–û–í–ê–ù–ê) === */
        #captureTarget {
            background-color: #1a1c23; /* –¢–µ–º–Ω–∏–π —Ñ–æ–Ω —è–∫ –Ω–∞ –º–∞–∫–µ—Ç—ñ */
            color: #ffffff;
            padding: 40px;
            border-radius: 20px;
            position: absolute; left: -9999px; top: 0; width: 540px; 
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
        }

        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 35px; }
        .header-title { font-size: 26px; font-weight: 900; text-transform: uppercase; line-height: 1.2; letter-spacing: 0.5px; }
        .header-title span { color: #fbbf24; } /* –ñ–æ–≤—Ç–∏–π –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –¥–∞—Ç—ñ */
        .logo-fixed { height: 50px; width: auto; object-fit: contain; }

        /* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∏–π —Ç–∞–π–º–ª–∞–π–Ω */
        .timeline-container {
            display: flex;
            flex-direction: column;
            position: relative;
            padding-left: 85px; /* –ú—ñ—Å—Ü–µ –¥–ª—è –≥–æ–¥–∏–Ω –∑–ª—ñ–≤–∞ */
        }

        /* –ñ–æ–≤—Ç–∞ –ª—ñ–Ω—ñ—è, —â–æ –π–¥–µ –∑–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ */
        .timeline-container::before {
            content: '';
            position: absolute;
            left: 55px; /* –†–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –ª—ñ–Ω—ñ—ó */
            top: 25px;
            bottom: 25px;
            width: 4px;
            background: #fbbf24;
            border-radius: 2px;
        }

        .tl-row {
            display: flex;
            align-items: stretch;
            margin-bottom: 15px;
            position: relative;
            min-height: 75px;
        }
        .tl-row:last-child { margin-bottom: 0; }

        /* –ß–∞—Å –∑–ª—ñ–≤–∞ */
        .tl-time {
            position: absolute;
            left: -85px;
            top: 50%;
            transform: translateY(-50%);
            font-weight: 800;
            font-size: 20px;
            color: #ffffff;
            width: 60px;
            text-align: right;
            letter-spacing: 1px;
        }

        /* –ö—Ä–∞–ø–∫–∞ –Ω–∞ –ª—ñ–Ω—ñ—ó */
        .tl-row::before {
            content: '';
            position: absolute;
            left: -34px; /* –í–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è –∫—Ä–∞–ø–∫–∏ –ø–æ –ª—ñ–Ω—ñ—ó */
            top: 50%;
            transform: translateY(-50%);
            width: 14px;
            height: 14px;
            background: #1a1c23;
            border: 4px solid #fbbf24;
            border-radius: 50%;
            z-index: 2;
        }

        /* –ë–ª–æ–∫–∏ —Å—Ç–∞—Ç—É—Å—ñ–≤ */
        .tl-block {
            flex: 1;
            border-radius: 16px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 15px;
            font-weight: 800;
            font-size: 24px;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
        }
        
        .tl-icon { width: 32px; height: 32px; margin-bottom: 4px; }

        /* –°–≤—ñ—Ç–ª–æ –Ñ */
        .tl-on {
            background: #fbbf24;
            color: #1a1c23;
            box-shadow: 0 0 25px rgba(251, 191, 36, 0.15);
        }

        /* –°–≤—ñ—Ç–ª–∞ –ù–ï–ú–ê–Ñ */
        .tl-off {
            background: #2a2d36;
            color: #ffffff;
            border: 2px solid rgba(255, 60, 48, 0.6);
            box-shadow: 0 0 25px rgba(255, 60, 48, 0.15);
        }
        .tl-off .tl-subtitle {
            font-size: 16px;
            font-weight: 600;
            color: #a1a1aa;
            margin-top: 4px;
        }

        .total-time {
            text-align: center;
            margin-top: 35px;
            font-size: 20px;
            font-weight: 500;
            color: #e4e4e7;
        }

        /* –†–ï–ó–£–õ–¨–¢–ê–¢ */
        #outputWrapper { display: none; width: 100%; }
        
        #generatedImage { 
            width: 100%; height: auto; border-radius: 12px; display: block; margin-bottom: 15px;
            box-shadow: 5px 5px 15px rgba(0,0,0,0.15);
        }

        /* COPY BLOCK NEUMORPHIC */
        .copy-block {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            background: var(--bg-app);
            box-shadow: 7px 7px 14px var(--neumorph-shadow-dark), 
                       -7px -7px 14px var(--neumorph-shadow-light);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            user-select: none;
        }

        .copy-block:active {
            box-shadow: inset 5px 5px 10px var(--neumorph-shadow-dark), 
                        inset -5px -5px 10px var(--neumorph-shadow-light);
            transform: scale(0.99);
        }
        
        .copy-block.copied {
            background: #e3fae3;
        }

        .copy-content {
            font-family: monospace;
            font-size: 14px;
            color: #333;
            white-space: pre-wrap;
            line-height: 1.4;
            pointer-events: none; /* –©–æ–± –∫–ª—ñ–∫ –ø—Ä–æ—Ö–æ–¥–∏–≤ –Ω–∞ –±–ª–æ–∫ */
        }

        .copy-hint {
            margin-top: 10px;
            font-size: 12px;
            color: #007aff;
            text-align: center;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .tools-row {
            display: flex; gap: 10px; margin-bottom: 15px;
        }

    </style>
</head>
<body>

    <div class="app-container">
        
        <div class="card">
            <h2>–ë–ª–µ–∫–∞—É—Ç-–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</h2>
            
            <div style="margin-bottom: 15px;">
                <label style="font-size:12px; font-weight:bold; color:#666; margin-left:5px; display:block; margin-bottom:5px;">–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç—É:</label>
                <select id="headerSelect" class="input-neumorph" onchange="toggleCustomHeader()">
                    <option value="classic">‚ö°Ô∏èüí° –ì–†–ê–§–Ü–ö –ù–ê [–î–ê–¢–ê]</option>
                    <option value="random">üí°üé≤ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö —á–∏—Å–µ–ª</option>
                    <option value="scifi">üîåüí° –ù–∞—É–∫–æ–≤–æ-—Ñ–∞–Ω—Ç–∞—Å—Ç–∏—á–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫</option>
                    <option value="habit">üí°üîå –ö–∞—Ä—Ç–∏–Ω–∫–∞ –∑–∞ –∑–≤–∏—á–∫–æ—é (–∞–≤–∞—Ä—ñ–π–∫–∞)</option>
                    <option value="parallel">üí°‚ö°Ô∏è –ì—Ä–∞—Ñ—ñ–∫ –∑ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ–≥–æ –≤—Å–µ—Å–≤—ñ—Ç—É</option>
                    <option value="dontcare">üí°üîå –ì—Ä–∞—Ñ—ñ–∫, —è–∫–∏–π –Ω–µ –≤–∞—Ä—Ç–æ –ø—Ä–∏–π–º–∞—Ç–∏ –±–ª–∏–∑—å–∫–æ –¥–æ —Å–µ—Ä—Ü—è</option>
                    <option value="custom">‚öôÔ∏è –í–ª–∞—Å–Ω–∞ –Ω–∞–∑–≤–∞...</option>
                </select>
                <input type="text" id="customHeaderInput" class="input-neumorph" style="display:none; margin-top:10px;" placeholder="–í–≤–µ–¥–∏ —Å–≤—ñ–π –∑–∞–≥–æ–ª–æ–≤–æ–∫...">
            </div>
        // –ù–û–í–Ü –Ü–ö–û–ù–ö–ò –î–õ–Ø –¢–ê–ô–ú–õ–ê–ô–ù–£
        const svgBulb = `<svg class="tl-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1.2 1.5-2.5 1.5-4a6 6 0 0 0-6-6 6 6 0 0 0-6 6c0 1.4.5 2.7 1.5 4 .7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>`;
        const svgZapOff = `<svg class="tl-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="2" y1="2" x2="22" y2="22"></line><path d="M8.5 8.5L3 14h9l-1 8 5.5-5.5"></path><path d="M16 10h5l-1.5 1.5"></path><path d="M12.4 6.6L13 2l-2.6 2.6"></path></svg>`;

        // –ï–ª–µ–º–µ–Ω—Ç–∏ –Ω–∞—à–æ–≥–æ –Ω–æ–≤–æ–≥–æ –¥–∏–∑–∞–π–Ω—É
        const timelineContainer = document.getElementById('timelineContainer');
        const totalTimeDisplay = document.getElementById('totalTimeDisplay');

        // –•–µ–ª–ø–µ—Ä–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —á–∞—Å–æ–º (–ø–µ—Ä–µ–≤–æ–¥–∏–º–æ –≤—Å–µ —É —Ö–≤–∏–ª–∏–Ω–∏ —ñ –Ω–∞–∑–∞–¥)
        function timeToMinutes(timeStr) {
            const [h, m] = timeStr.replace(/[^\d:]/g, '').split(':').map(Number);
            return (h || 0) * 60 + (m || 0);
        }

        function minutesToTime(mins) {
            const h = Math.floor(mins / 60);
            const m = mins % 60;
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
        }

            <textarea id="rawText" class="input-neumorph" placeholder="–í—Å—Ç–∞–≤ —Ç–µ–∫—Å—Ç –≥—Ä–∞—Ñ—ñ–∫—É –≤—ñ–¥ –•–∞—Ä–∫—ñ–≤–æ–±–ª–µ–Ω–µ—Ä–≥–æ —Å—é–¥–∏..."></textarea>
            
            <div class="btn-group">
                <button class="btn-neu btn-primary" onclick="processDataAndGenerate()">‚ö° –°—Ç–≤–æ—Ä–∏—Ç–∏</button>
                <button class="btn-neu btn-danger" onclick="clearAll()">‚ùå</button>
            </div>
            <div id="debug" style="color:red; font-size:12px; margin-top:10px; text-align:center;"></div>
        </div>

        <div id="outputWrapper">
            
            <div class="tools-row">
                <button class="btn-neu" onclick="saveImageToGallery()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É</button>
                <button class="btn-neu" onclick="randomizeTheme()">üé® –ö–æ–ª—ñ—Ä</button>
            </div>

            <img id="generatedImage" src="">

            <div class="copy-block" id="copyBlock" onclick="copyToClipboard()">
                <div class="copy-content" id="finalText">–¢—É—Ç –±—É–¥–µ —Ç–µ–∫—Å—Ç...</div>
                <div class="copy-hint" id="copyHint">–¢–∞–ø–Ω–∏, —â–æ–± —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç</div>
            </div>
        </div>

    </div>

        <div id="captureTarget">
        <div class="header-row">
            <div class="header-title" id="dateDisplay">–ì–†–ê–§–Ü–ö –í–Ü–î–ö–õ–Æ–ß–ï–ù–¨<br>–ù–ê <span>17 –õ–Æ–¢–û–ì–û</span></div>
            <img src="./logo.png" alt="Logo" class="logo-fixed" onerror="this.style.display='none'">
        </div>
        
        <div class="timeline-container" id="timelineContainer"></div>

        <div class="total-time" id="totalTimeDisplay">–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å –±–µ–∑ —Å–≤—ñ—Ç–ª–∞: ~0 –≥–æ–¥–∏–Ω.</div>
    </div>

    <script>
        // === –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø ===
        
        // –ü–æ–≤–Ω–∏–π –Ω–∞–±—ñ—Ä –≥–æ–¥–∏–Ω–Ω–∏–∫—ñ–≤
        const clocksFull = {
            '00:00': 'üïõ', '00:30': 'üïß',
            '01:00': 'üïê', '01:30': 'üïú',
            '02:00': 'üïë', '02:30': 'üïù',
            '03:00': 'üïí', '03:30': 'üïû',
            '04:00': 'üïì', '04:30': 'üïü',
            '05:00': 'üïî', '05:30': 'üï†',
            '06:00': 'üïï', '06:30': 'üï°',
            '07:00': 'üïñ', '07:30': 'üï¢',
            '08:00': 'üïó', '08:30': 'üï£',
            '09:00': 'üïò', '09:30': 'üï§',
            '10:00': 'üïô', '10:30': 'üï•',
            '11:00': 'üïö', '11:30': 'üï¶',
            '12:00': 'üïõ', '12:30': 'üïß',
            // —ñ —Ç–∞–∫ –¥–∞–ª—ñ –ø–æ –∫–æ–ª—É, –∞–ª–µ –ø—Ä–æ—Å—Ç—ñ—à–µ —Ñ—É–Ω–∫—Ü—ñ—î—é
        };

        const themes = [
            { bg: '#fbbf24', txt: '#1f2937', darkBg: '#1f2937', darkTxt: '#ffffff' }, // Classic Yellow
            { bg: '#fcd34d', txt: '#000000', darkBg: '#111827', darkTxt: '#ffffff' }, // Brighter Yellow
            { bg: '#fb923c', txt: '#000000', darkBg: '#2d1b0e', darkTxt: '#ffffff' }, // Orange hint
            { bg: '#fef08a', txt: '#000000', darkBg: '#000000', darkTxt: '#fef08a' }, // Pale Yellow / Black
            { bg: '#1f2937', txt: '#ffffff', darkBg: '#000000', darkTxt: '#e5e7eb' }, // Dark Mode (Invertedish)
            { bg: '#eab308', txt: '#ffffff', darkBg: '#1f2937', darkTxt: '#eab308' }, // Deep Gold
        ];

        // –Ü–ö–û–ù–ö–ò
        const iconBulb = `<svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-1.2 1.5-2.5 1.5-4a6 6 0 0 0-6-6 6 6 0 0 0-6 6c0 1.4.5 2.7 1.5 4 .7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>`;
        const iconZapOff = `<svg class="icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><polyline points="12.41 6.75 13 2 10.57 4.92"/><polyline points="18.57 12.91 21 10 15.66 10"/><polyline points="8 8 3 14 12 14 11 22 16 16"/><line x1="2" y1="2" x2="22" y2="22"/></svg>`;

        // === DOM ===
        const grid = document.getElementById('grid');
        const debug = document.getElementById('debug');
        const dateDisplay = document.getElementById('dateDisplay');
        const finalTextDiv = document.getElementById('finalText');
        const copyBlock = document.getElementById('copyBlock');
        const copyHint = document.getElementById('copyHint');
        const captureTarget = document.getElementById('captureTarget');
        const outputWrapper = document.getElementById('outputWrapper');
        const generatedImage = document.getElementById('generatedImage');
        const headerSelect = document.getElementById('headerSelect');
        const customHeaderInput = document.getElementById('customHeaderInput');

        
        let currentThemeIndex = 0;
        let lastDateStr = "";
        let lastTextIntervals = "";

        

        // === –õ–û–ì–Ü–ö–ê ===
        function toggleCustomHeader() {
            if (headerSelect.value === 'custom') {
                customHeaderInput.style.display = 'block';
            } else {
                customHeaderInput.style.display = 'none';
            }
        }

        function getHeaderTitle(dateStr) {
            let base = "";
            switch(headerSelect.value) {
                case 'classic': base = "‚ö°Ô∏èüí° –ì–†–ê–§–Ü–ö"; break;
                case 'random': base = "üí°üé≤ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö —á–∏—Å–µ–ª –≤—ñ–¥ –•–∞—Ä–∫—ñ–≤–æ–±–ª–µ–Ω–µ—Ä–≥–æ"; break;
                case 'scifi': base = "üîåüí° –ù–∞—É–∫–æ–≤–æ-—Ñ–∞–Ω—Ç–∞—Å—Ç–∏—á–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫"; break;
                case 'habit': base = "üí°üîå –ö–∞—Ä—Ç–∏–Ω–∫–∞, —è–∫—É –º–∏ –ø–æ—Å—Ç–∏–º–æ –∑–∞ –∑–≤–∏—á–∫–æ—é (–≤—Å–µ –æ–¥–Ω–æ –±—É–¥–µ –∞–≤–∞—Ä—ñ–π–∫–∞, —Ö–µ—Ö–µ)"; break;
                case 'parallel': base = "üí°‚ö°Ô∏è –ì—Ä–∞—Ñ—ñ–∫ –∑ –ø–∞—Ä–∞–ª–µ–ª—å–Ω–æ–≥–æ –≤—Å–µ—Å–≤—ñ—Ç—É, –≤ —è–∫–æ–º—É –Ω–µ —ñ—Å–Ω—É—î –†–æ—Å—ñ—ó —ñ –∞–≤–∞—Ä—ñ–π–Ω–∏—Ö –≤—ñ–¥–∫–ª—é—á–µ–Ω—å"; break;
                case 'dontcare': base = "üí°üîå –ì—Ä–∞—Ñ—ñ–∫, —è–∫–∏–π –Ω–µ –≤–∞—Ä—Ç–æ –ø—Ä–∏–π–º–∞—Ç–∏ –±–ª–∏–∑—å–∫–æ –¥–æ —Å–µ—Ä—Ü—è"; break;
                case 'custom': base = customHeaderInput.value || "‚ö°Ô∏è –ì–†–ê–§–Ü–ö"; break;
                default: base = "‚ö°Ô∏èüí° –ì–†–ê–§–Ü–ö";
            }
            
            // –Ø–∫—â–æ –æ–±—Ä–∞–Ω–æ –ù–ï –∫–ª–∞—Å–∏–∫—É, –¥–æ–¥–∞—î–º–æ "–Ω–∞ [–¥–∞—Ç–∞]" –≤ –∫—ñ–Ω–µ—Ü—å
            // –Ø–∫—â–æ –∫–ª–∞—Å–∏–∫–∞ - —Ç–∞–º —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è "–ì–†–ê–§–Ü–ö –ù–ê [–î–ê–¢–ê]"
            if (headerSelect.value === 'classic') {
                return `${base} –ù–ê ${dateStr}`;
            } else {
                return `${base} –Ω–∞ ${dateStr}`;
            }
        }

        function getClockEmoji(timeStr) {
            // –ù–æ—Ä–º–∞–ª—ñ–∑—É—î–º–æ —á–∞—Å
            let [h, m] = timeStr.split(':').map(Number);
            if (isNaN(m)) m = 0;
            
            // –í–∏–∑–Ω–∞—á–∞—î–º–æ —ñ–Ω–¥–µ–∫—Å –≥–æ–¥–∏–Ω–Ω–∏–∫–∞ (12 –≥–æ–¥–∏–Ω–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç)
            let emojiTimeH = h % 12; 
            if (emojiTimeH === 0) emojiTimeH = 12; // 12:00 -> üïõ
            
            // –ú–∞—Å–∏–≤ Unicode –≥–æ–¥–∏–Ω–Ω–∏–∫—ñ–≤: [1:00, 2:00 ... 12:00]
            // –ü–æ–ª–æ–≤–∏–Ω–∫–∏: [1:30, 2:30 ... 12:30]
            
            const fullClocks = ['üïõ','üïê','üïë','üïí','üïì','üïî','üïï','üïñ','üïó','üïò','üïô','üïö'];
            const halfClocks = ['üïß','üïú','üïù','üïû','üïü','üï†','üï°','üï¢','üï£','üï§','üï•','üï¶'];
            
            // –Ü–Ω–¥–µ–∫—Å —É –º–∞—Å–∏–≤—ñ (0 = 12, 1 = 1, 2 = 2...)
            let idx = emojiTimeH === 12 ? 0 : emojiTimeH;
            
            if (m >= 30) return halfClocks[idx];
            return fullClocks[idx];
        }

        

        function processDataAndGenerate() {
            const text = document.getElementById('rawText').value;
            debug.textContent = "";
            timelineContainer.innerHTML = ""; // –û—á–∏—â–∞—î–º–æ –µ–∫—Ä–∞–Ω
            
            // 1. –ü–æ—à—É–∫ –¥–∞—Ç–∏
            const dateRegex = /(\d{1,2})\s+(—Å—ñ—á–Ω—è|–ª—é—Ç–æ–≥–æ|–±–µ—Ä–µ–∑–Ω—è|–∫–≤—ñ—Ç–Ω—è|—Ç—Ä–∞–≤–Ω—è|—á–µ—Ä–≤–Ω—è|–ª–∏–ø–Ω—è|—Å–µ—Ä–ø–Ω—è|–≤–µ—Ä–µ—Å–Ω—è|–∂–æ–≤—Ç–Ω—è|–ª–∏—Å—Ç–æ–ø–∞–¥–∞|–≥—Ä—É–¥–Ω—è)/i;
            const dateMatch = text.match(dateRegex);
            let dateStr = "–°–¨–û–ì–û–î–ù–Ü";
            if (dateMatch) dateStr = dateMatch[0].toUpperCase();
            lastDateStr = dateStr;

            // –û–Ω–æ–≤–ª—é—î–º–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–∂–æ–≤—Ç–∏–π –∞–∫—Ü–µ–Ω—Ç –Ω–∞ –¥–∞—Ç—ñ)
            document.getElementById('dateDisplay').innerHTML = `–ì–†–ê–§–Ü–ö –í–Ü–î–ö–õ–Æ–ß–ï–ù–¨<br>–ù–ê <span>${dateStr}</span>`;

            // 2. –ü–∞—Ä—Å–∏–Ω–≥ 1.2
            const regex = /(?:^|\n)\s*1\.2\s+([^\n]+)/;
            const match = text.match(regex);
            if (!match) { debug.textContent = "–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ —á–µ—Ä–≥—É 1.2!"; return; }

            const ranges = match[1].trim().split(';');
            let outages = [];
            let totalOffMinutes = 0;
            let textIntervals = [];

            ranges.forEach(range => {
                let parts = range.split(/[\-\‚Äì\‚Äî]/); 
                if (parts.length < 2) return;
                
                let startStr = parts[0].trim(); 
                let endStr = parts[1].trim();

                let startMin = timeToMinutes(startStr);
                let endMin = timeToMinutes(endStr);
                
                if (endMin === 0 || endStr === "24:00") endMin = 1440; // –Ø–∫—â–æ –¥–æ –æ–ø—ñ–≤–Ω–æ—á—ñ
                if (endMin < startMin) endMin = 1440; // –ü–µ—Ä–µ—Ö—ñ–¥ —á–µ—Ä–µ–∑ –Ω—ñ—á

                outages.push({ startMin, endMin, startStr, displayEndStr: (endStr === "24:00" ? "00:00" : endStr) });
                totalOffMinutes += (endMin - startMin);
                
                // –¢–µ–∫—Å—Ç –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è
                let displayStartText = startStr === "24:00" ? "00:00" : startStr;
                let displayEndText = endStr === "24:00" ? "00:00" : endStr;
                textIntervals.push(`${getClockEmoji(startStr)} ${displayStartText}-${displayEndText}`);
            });

            lastTextIntervals = textIntervals.join('\n');

            // –°–æ—Ä—Ç—É—î–º–æ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –ø–æ —á–∞—Å—É (—â–æ–± –π—à–ª–∏ –ø–æ –ø–æ—Ä—è–¥–∫—É)
            outages.sort((a, b) => a.startMin - b.startMin);

            // –ë—É–¥—É—î–º–æ –±–ª–æ–∫–∏ (–°–≤—ñ—Ç–ª–æ —î -> –ù–µ–º–∞—î -> –Ñ)
            let currentTime = 0;
            
            outages.forEach(outage => {
                // –Ø–∫—â–æ —î –ø—Ä–æ–º—ñ–∂–æ–∫ –∑—ñ —Å–≤—ñ—Ç–ª–æ–º –î–û –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
                if (currentTime < outage.startMin) {
                    addTimelineBlock(currentTime, outage.startMin, true);
                }
                // –ë–ª–æ–∫ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
                addTimelineBlock(outage.startMin, outage.endMin, false, outage.startStr, outage.displayEndStr);
                currentTime = outage.endMin;
            });

            // –Ø–∫—â–æ –ø—ñ—Å–ª—è –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –≤—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —â–µ —î —á–∞—Å –¥–æ 24:00
            if (currentTime < 1440) {
                addTimelineBlock(currentTime, 1440, true);
            }

            // –û–Ω–æ–≤–ª—é—î–º–æ –∑–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å –≤–Ω–∏–∑—É (–º–∞–≥—ñ—è, —è–∫—É –≤—Å—ñ –±—É–¥—É—Ç—å —à–µ—Ä–∏—Ç–∏)
            const totalHours = (totalOffMinutes / 60).toFixed(1).replace('.0', '');
            totalTimeDisplay.textContent = `–ó–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å –±–µ–∑ —Å–≤—ñ—Ç–ª–∞: ~${totalHours} –≥–æ–¥–∏–Ω.`;

            // –û–Ω–æ–≤–ª—é—î–º–æ —Ç–µ–∫—Å—Ç –¥–ª—è –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è —ñ –ø–æ–∫–∞–∑—É—î–º–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            updateCopyText();
            outputWrapper.style.display = 'block';
            setTimeout(generateImageOutput, 200);
        }

        // –§—É–Ω–∫—Ü—ñ—è, —è–∫–∞ —Å—Ç–≤–æ—Ä—é—î –æ–¥–∏–Ω –±–ª–æ–∫ —É –Ω–∞—à–æ–º—É —Å–ø–∏—Å–∫—É
        function addTimelineBlock(startMin, endMin, isOn, customStartStr = null, customEndStr = null) {
            const startStr = customStartStr || minutesToTime(startMin);
            const endStr = customEndStr || (endMin === 1440 ? "24:00" : minutesToTime(endMin));

            const row = document.createElement('div');
            row.className = 'tl-row';

            // –ì–æ–¥–∏–Ω–Ω–∏–∫ –∑–ª—ñ–≤–∞
            const timeLabel = document.createElement('div');
            timeLabel.className = 'tl-time';
            timeLabel.textContent = startStr;
            row.appendChild(timeLabel);

            // –°–∞–º –∫–æ–ª—å–æ—Ä–æ–≤–∏–π –±–ª–æ–∫
            const block = document.createElement('div');
            if (isOn) {
                block.className = 'tl-block tl-on';
                block.innerHTML = `${svgBulb}<div>–°–≤—ñ—Ç–ª–æ —î</div>`;
            } else {
                block.className = 'tl-block tl-off';
                block.innerHTML = `${svgZapOff}<div>${startStr} ‚Äî ${endStr}</div><div class="tl-subtitle">–°–≤—ñ—Ç–ª–∞ –Ω–µ–º–∞—î</div>`;
            }
            row.appendChild(block);

            timelineContainer.appendChild(row);
        }


        function updateCopyText() {
            const header = getHeaderTitle(lastDateStr);
            finalTextDiv.textContent = `${header}\n\n${lastTextIntervals}\n\n–•–∞—Ä–∫—ñ–≤–æ–±–ª–µ–Ω–µ—Ä–≥–æ`;
            copyBlock.classList.remove('copied');
            copyHint.textContent = "–¢–∞–ø–Ω–∏, —â–æ–± —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ —Ç–µ–∫—Å—Ç";
            copyHint.style.color = "#007aff";
        }

       

        

        function generateImageOutput() {
            html2canvas(captureTarget, {
                scale: 3, 
                backgroundColor: null, // –ø—Ä–æ–∑–æ—Ä–∏–π, —â–æ–± –≤–∑—è—Ç–∏ –∫–æ–ª—ñ—Ä CSS
                logging: false,
                useCORS: true
            }).then(canvas => {
                generatedImage.src = canvas.toDataURL('image/png');
            });
        }

        // === –ü–õ–Æ–®–ö–ò ===

        function copyToClipboard() {
            const text = finalTextDiv.textContent;
            navigator.clipboard.writeText(text).then(() => {
                copyBlock.classList.add('copied');
                copyHint.textContent = "–°–ö–û–ü–Ü–ô–û–í–ê–ù–û! ‚úÖ";
                copyHint.style.color = "#28a745";
                if(navigator.vibrate) navigator.vibrate(50);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert("–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. –°–ø—Ä–æ–±—É–π –≤—Ä—É—á–Ω—É.");
            });
        }

        async function saveImageToGallery() {
            if (!generatedImage.src) return;
            
            try {
                const response = await fetch(generatedImage.src);
                const blob = await response.blob();
                const file = new File([blob], "grafik.png", { type: "image/png" });

                if (navigator.share) {
                    await navigator.share({
                        files: [file]
                    });
                } else {
                    // Fallback –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø—É / —Å—Ç–∞—Ä–∏—Ö –±—Ä–∞—É–∑–µ—Ä—ñ–≤
                    const link = document.createElement("a");
                    link.href = generatedImage.src;
                    link.download = "grafik.png";
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                }
            } catch (err) {
                console.error("Error sharing:", err);
                alert("–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è. –°–ø—Ä–æ–±—É–π –∑—Ä–æ–±–∏—Ç–∏ —Å–∫—Ä—ñ–Ω—à–æ—Ç.");
            }
        }

        function randomizeTheme() {
            currentThemeIndex = (currentThemeIndex + 1) % themes.length;
            const t = themes[currentThemeIndex];
            
            const root = document.documentElement;
            root.style.setProperty('--light-bg', t.bg);
            root.style.setProperty('--light-text', t.txt);
            root.style.setProperty('--dark-bg', t.darkBg);
            root.style.setProperty('--dark-text', t.darkTxt);
            
            // –ü–µ—Ä–µ–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –∫–∞—Ä—Ç–∏–Ω–∫—É –∑ –Ω–æ–≤–∏–º–∏ –∫–æ–ª—å–æ—Ä–∞–º–∏
            // –°–ø–æ—á–∞—Ç–∫—É –æ–Ω–æ–≤–∏–º–æ DOM —Å—ñ—Ç–∫—É
            hoursStatus.forEach((_, i) => renderSingle(i));
            setTimeout(generateImageOutput, 100);
        }

        function clearAll() {
            document.getElementById('rawText').value = '';
            timelineContainer.innerHTML = '';
            outputWrapper.style.display = 'none';
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        initGrid();
        window.addEventListener('resize', () => { hoursStatus.forEach((_, i) => renderSingle(i)); });

    </script>
</body>
</html>
